<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Flashcard Sets</title>
    <link rel="stylesheet" href="view_flashcards.css">
</head>

<body>
    <!-- Home button -->
    <a id="home-btn" href="home.html">Home</a>
    <a id="back-btn" style="display: none;" href="javascript:void(0)" onclick="showSubjects()">Back</a>

    <h2>Flashcard Sets</h2>

    <!-- Subject Boxes -->
    <div id="subject-list" class="subject-list">
        <button onclick="loadFlashcardSetsBySubject('math')">Math</button>
        <button onclick="loadFlashcardSetsBySubject('science')">Science</button>
        <button onclick="loadFlashcardSetsBySubject('social studies')">Social Studies</button>
        <button onclick="loadFlashcardSetsBySubject('languages')">Languages</button>
        <button onclick="loadFlashcardSetsBySubject('other')">Other</button>
    </div>

    <!-- List of Flashcard Sets -->
    <div id="flashcard-set-list" style="display: none;">
        <!-- Flashcard set buttons will be added here dynamically -->
    </div>

    <!-- Flashcard Set Details -->
    <div id="flashcard-details" style="display: none;">
        <div id="set-info">
            <h3 id="set-name"></h3>
            <p><strong>Created by:</strong> <span id="creator-name"></span></p>
        </div>

        <div id="flashcards-container">
            <!-- Flashcards will be displayed here dynamically -->
        </div>
    </div>

    <!-- Firebase App and Firestore SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBxR-gB1srBMUlQNvwOy1M2fVHIKaClTZs",
            authDomain: "sweflashcardwebsite.firebaseapp.com",
            projectId: "sweflashcardwebsite",
            storageBucket: "sweflashcardwebsite.appspot.com",
            messagingSenderId: "1017040813605",
            appId: "1:1017040813605:web:fe254a4afe244d341909cc",
            measurementId: "G-NHEQY035NK"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Load flashcard sets for the selected subject
        async function loadFlashcardSetsBySubject(subject) {
            const flashcardSetList = document.getElementById('flashcard-set-list');
            flashcardSetList.innerHTML = ''; // Clear previous sets
            document.getElementById('subject-list').style.display = 'none';
            flashcardSetList.style.display = 'block';
            document.getElementById('back-btn').style.display = 'block';

            try {
                const setsSnapshot = await db.collection('flashcardsets').doc(subject).collection('sets').get();

                if (setsSnapshot.empty) {
                    flashcardSetList.innerHTML = `<p>No flashcard sets found for ${subject}.</p>`;
                } else {
                    setsSnapshot.forEach((doc) => {
                        const setData = doc.data();
                        const setId = doc.id;

                        const button = document.createElement('button');
                        button.textContent = setData.name;
                        button.onclick = () => loadFlashcardSetDetails(subject, setId);
                        flashcardSetList.appendChild(button);
                    });
                }
            } catch (error) {
                console.error("Error loading flashcard sets for subject:", error);
            }
        }

        // Load details of a flashcard set
        async function loadFlashcardSetDetails(subject, setId) {
            const flashcardSetListDiv = document.getElementById('flashcard-set-list');
            const flashcardDetailsDiv = document.getElementById('flashcard-details');
            const setNameElement = document.getElementById('set-name');
            const creatorNameElement = document.getElementById('creator-name');
            const flashcardsContainer = document.getElementById('flashcards-container');

            flashcardsContainer.innerHTML = ''; // Clear previous flashcard details

            try {
                const setDoc = await db.collection('flashcardsets').doc(subject).collection('sets').doc(setId).get();

                if (setDoc.exists) {
                    const setData = setDoc.data();

                    setNameElement.textContent = setData.name;
                    creatorNameElement.textContent = await getUsernameByUID(setData.creator);

                    flashcardSetListDiv.style.display = 'none';
                    flashcardDetailsDiv.style.display = 'block';

                    setData.flashcards.forEach((flashcard) => {
                        const flashcardDiv = document.createElement('div');
                        flashcardDiv.classList.add('flashcard');

                        const frontDiv = document.createElement('div');
                        frontDiv.classList.add('front');
                        frontDiv.innerHTML = `<strong>Front:</strong> ${flashcard.front}`;

                        const backDiv = document.createElement('div');
                        backDiv.classList.add('back');
                        backDiv.innerHTML = `<strong>Back (Options):</strong>`;

                        flashcard.back.forEach((option) => {
                            const optionDiv = document.createElement('div');
                            optionDiv.classList.add('option');
                            if (option.isCorrect) {
                                optionDiv.classList.add('correct');
                            }
                            optionDiv.textContent = option.option;
                            backDiv.appendChild(optionDiv);
                        });

                        flashcardDiv.appendChild(frontDiv);
                        flashcardDiv.appendChild(backDiv);
                        flashcardsContainer.appendChild(flashcardDiv);
                    });

                } else {
                    alert("Flashcard set not found.");
                }
            } catch (error) {
                console.error("Error loading flashcard set details:", error);
            }
        }

        // Fetch username by UID
        async function getUsernameByUID(uid) {
            try {
                const userDoc = await db.collection('users').doc(uid).get();
                return userDoc.exists ? userDoc.data().username : "Unknown";
            } catch (error) {
                console.error("Error fetching username:", error);
                return "Unknown";
            }
        }

        // Show the subject list and hide other views
        function showSubjects() {
            document.getElementById('subject-list').style.display = 'block';
            document.getElementById('flashcard-set-list').style.display = 'none';
            document.getElementById('flashcard-details').style.display = 'none';
            document.getElementById('back-btn').style.display = 'none';
        }

        // Load subjects when page loads
        window.onload = showSubjects;
    </script>
</body>

</html>